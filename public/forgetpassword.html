<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quên mật khẩu</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="login-page">
    <a href="index.html" class="home-button">
        <i class="fas fa-home"></i>
        Trang chủ
    </a>

    <div class="login-container" style="height: 400px; width: 400px; padding: 40px;">
        <h2>QUÊN MẬT KHẨU</h2>

        <form id="forgetPasswordForm">
            <div class="input-container">
                <i class="fas fa-envelope"></i>
                <input type="email" id="email" placeholder="Nhập email đã đăng ký" required>
            </div>

            <div class="input-container">
                <i class="fas fa-phone"></i>
                <input type="tel" id="phone" placeholder="Nhập số điện thoại" 
                       pattern="^(0|\+84)\d{9,10}$" 
                       title="Số điện thoại bắt đầu bằng 0 hoặc +84, từ 10-11 số" required>
            </div>

            <button type="submit">Xác nhận</button>
        </form>

        <a href="login.html" class="create-account">Đăng nhập</a>
    </div>

    <div id="loginMessage"></div>

    <!-- Modal thông báo lỗi -->
    <div id="errorModal" class="modal">
        <div class="modal-content">
            <div class="error-icon">
                <i class="fas fa-exclamation-circle"></i>
            </div>
            <h3>Lỗi xác thực</h3>
            <p id="errorMessage">Thông tin không chính xác!</p>
            <button id="okButton">OK</button>
        </div>
    </div>

    <!-- Modal thành công -->
    <div id="successModal" class="modal">
        <div class="modal-content">
            <div class="success-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h3>Thành công</h3>
            <p>Mật khẩu mới của bạn là: <span id="newPassword" style="font-weight: bold; font-size: 1.2em; color: #4CAF50;"></span></p>
            <p style="font-size: 0.9em; margin-top: 10px;">Vui lòng ghi nhớ mật khẩu này và đổi mật khẩu sau khi đăng nhập.</p>
            <button id="okButtonSuccess">OK</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Xử lý hiển thị và ẩn modal
            function showErrorModal(title, message) {
                const modal = document.getElementById('errorModal');
                const modalTitle = modal.querySelector('h3');
                const errorMessage = document.getElementById('errorMessage');
                
                modalTitle.textContent = title;
                errorMessage.textContent = message;
                modal.classList.add('show');
            }
            
            function showSuccessModal(newPassword) {
                const modal = document.getElementById('successModal');
                document.getElementById('newPassword').textContent = newPassword;
                modal.classList.add('show');
            }
            
            // Xử lý sự kiện khi click nút OK trên modal
            document.getElementById('okButton').addEventListener('click', function() {
                document.getElementById('errorModal').classList.remove('show');
            });
            
            document.getElementById('okButtonSuccess').addEventListener('click', function() {
                document.getElementById('successModal').classList.remove('show');
                window.location.href = 'login.html';
            });
            
            // Xử lý form quên mật khẩu
            document.getElementById('forgetPasswordForm').addEventListener('submit', async function(event) {
                event.preventDefault();
                
                const email = document.getElementById('email').value;
                const phone = document.getElementById('phone').value;
                
                // Kiểm tra dữ liệu
                if (!email || !phone) {
                    showErrorModal('Lỗi xác thực', 'Vui lòng nhập đầy đủ thông tin!');
                    return;
                }
                
                try {
                    // Gửi yêu cầu reset mật khẩu
                    const response = await fetch('/reset-password', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, phone })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        showSuccessModal(data.newPassword);
                    } else {
                        showErrorModal('Lỗi xác thực', data.message || 'Thông tin không chính xác!');
                    }
                } catch (error) {
                    showErrorModal('Lỗi kết nối', 'Đã xảy ra lỗi, vui lòng thử lại sau!');
                }
            });
        });
    </script>
</body>
</html> 